<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:json-logger="http://www.mulesoft.org/schema/mule/json-logger"
	xmlns:ibm-mq="http://www.mulesoft.org/schema/mule/ibm-mq"
	xmlns:file="http://www.mulesoft.org/schema/mule/file" xmlns:os="http://www.mulesoft.org/schema/mule/os"
	xmlns:compression="http://www.mulesoft.org/schema/mule/compression"
	xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd 
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/compression http://www.mulesoft.org/schema/mule/compression/current/mule-compression.xsd
http://www.mulesoft.org/schema/mule/os http://www.mulesoft.org/schema/mule/os/current/mule-os.xsd
http://www.mulesoft.org/schema/mule/file http://www.mulesoft.org/schema/mule/file/current/mule-file.xsd
http://www.mulesoft.org/schema/mule/ibm-mq http://www.mulesoft.org/schema/mule/ibm-mq/current/mule-ibm-mq.xsd
http://www.mulesoft.org/schema/mule/json-logger http://www.mulesoft.org/schema/mule/json-logger/current/mule-json-logger.xsd">
	<sub-flow name="sgst-object-store-retrievekeylist-impl-flow" doc:id="adb7721a-bf52-4178-975f-9913943d196c" >
		<http:request method="GET" doc:name="Get KeyList" doc:id="8aab7ea7-047d-4da4-a6e5-c63aab0b55c3" config-ref="HTTP_Request_ObjectStore_configuration" path="${http.ob.keyListPath}">
			<http:uri-params ><![CDATA[#[output application/java
---
{
	"orgId" : "${http.ob.orgId}",
	"envId": "${http.ob.envId}",
	"storeId": "${http.ob.storeId}",
	"partitionId": "${http.ob.partitionId}"
}]]]></http:uri-params>
		</http:request>
		<ee:transform doc:name="ObjectStore KeyList" doc:id="3671758c-f2e9-4e9e-bd2d-89f5e22cc37a" >
			<ee:message >
			</ee:message>
			<ee:variables >
				<ee:set-variable resource="dwl/objectStoreCount.dwl" variableName="ObjectStoreCount" />
				<ee:set-variable resource="dwl/objectStoreKeyList.dwl" variableName="objectStoreKeyList" />
			</ee:variables>
		</ee:transform>
		<json-logger:logger doc:name="Log KeyList" doc:id="be379090-b4f1-4808-8439-356fc261a162" config-ref="JSON_Logger_Config" message='#["Retrieve ObjectStore KeyList is Successful for correlation Id " ++ vars.TransactionID]' tracePoint="AFTER_REQUEST">
			<json-logger:content ><![CDATA[#[import modules::JSONLoggerModule output application/json ---
{
    payload: JSONLoggerModule::stringifyNonJSON(vars.eventAuditMessage) 
}]]]></json-logger:content>
		</json-logger:logger>
	</sub-flow>
	<sub-flow name="sgst-object-store-retrieve-impl-flow" doc:id="940404f8-7869-4412-a131-117a183045ea" >
		<http:request method="GET" doc:name="Get ObjectStore KeyValue" doc:id="efb3c4eb-2107-43ad-b520-fa1969edb5cd" config-ref="HTTP_Request_ObjectStore_configuration" path="${http.ob.keyValuePath}">
			<http:uri-params ><![CDATA[#[output application/java
---
{
	"orgId" : "${http.ob.orgId}",
	"envId": "${http.ob.envId}",
	"storeId": "${http.ob.storeId}",
	"partitionId": "${http.ob.partitionId}",
	"keyId": payload
}]]]></http:uri-params>
		</http:request>
		<ee:transform doc:name="Set Response" doc:id="9a339b8d-3387-48a6-83de-ac1995728c2b" >
			<ee:message >
				<ee:set-payload resource="dwl/obsResponse.dwl" />
			</ee:message>
		</ee:transform>
		<json-logger:logger doc:name="Log ObjectStore Retrieve" doc:id="0793dd90-527c-4501-936e-6669370b3400" config-ref="JSON_Logger_Config" message='#["Retrieve ObjectSotre key value is Successful for correlation Id " ++ vars.TransactionID]' tracePoint="AFTER_REQUEST">
			<json-logger:content ><![CDATA[#[import modules::JSONLoggerModule output application/json ---
{
    payload: JSONLoggerModule::stringifyNonJSON(vars.eventAuditMessage) 
}]]]></json-logger:content>
		</json-logger:logger>
	</sub-flow>
	<sub-flow name="sgst-object-store-delete-impl-flow" doc:id="67660907-4701-49b9-952a-43d415acc31a" >
		<http:request method="DELETE" doc:name="Delete OB Key Value" doc:id="1acd6b6e-cef2-4132-b18c-57a478ed9dda" config-ref="HTTP_Request_ObjectStore_configuration" path="${http.ob.keyValuePath}">
			<http:uri-params ><![CDATA[#[output application/java
---
{
	"orgId" : "${http.ob.orgId}",
	"envId": "${http.ob.envId}",
	"storeId": "${http.ob.storeId}",
	"partitionId": "${http.ob.partitionId}",
	"keyId": payload
}]]]></http:uri-params>
		</http:request>
		<json-logger:logger doc:name="Log Delete ObjectStore" doc:id="24481112-11dc-4dbf-8d12-221413e4d992" config-ref="JSON_Logger_Config" message='#["Delete ObjectStore key is Successful for correlation Id " ++ vars.TransactionID]' tracePoint="AFTER_REQUEST">
			<json-logger:content ><![CDATA[#[import modules::JSONLoggerModule output application/json ---
{
    payload: JSONLoggerModule::stringifyNonJSON(vars.eventAuditMessage) 
}]]]></json-logger:content>
		</json-logger:logger>
	</sub-flow>
	<sub-flow name="sgst-pmpc-gitp-sapi-sub-flow" doc:id="9fd7ca1e-8cd8-43e2-a87a-b08c14de11f5" >
		<ee:transform doc:name="Set Request" doc:id="ccaf49bf-f4e8-4aa1-89d5-653f695c9879" >
			<ee:message >
				<ee:set-payload resource="dwl/mqPublishRequest.dwl" />
			</ee:message>
		</ee:transform>
		<ibm-mq:publish doc:name="Publish" doc:id="0a927de5-b5ce-4d1d-85f2-ede2c1ac244f" config-ref="IBM_MQ_PMPC_Config" destination="${ibmMQ.pmpc.queueName}"/>
		<json-logger:logger doc:name="Log Publish Message" doc:id="0d0de72f-b5af-4315-a567-b250fda6bbea" config-ref="JSON_Logger_Config" message='#["Publish Message to IBM MQ is Successful for correlation Id " ++ vars.TransactionID]' tracePoint="AFTER_REQUEST">
			<json-logger:content ><![CDATA[#[import modules::JSONLoggerModule output application/json ---
{
    payload: JSONLoggerModule::stringifyNonJSON(vars.eventAuditMessage) 
}]]]></json-logger:content>
		</json-logger:logger>
	</sub-flow>
</mule>
